# iflow-cli æŠ€èƒ½æµ‹è¯•é—®é¢˜ä¿®å¤æ€»ç»“

## é—®é¢˜æè¿°

æ‚¨åœ¨ iflow ä¸­æµ‹è¯• dnaspec ç›¸å…³æŠ€èƒ½æ—¶é‡åˆ°é”™è¯¯ï¼š

```
Command failed with exit code 1:
"E:\nvm4w\nodejs\node.exe" "C:\Users\Zhang\AppData\Roaming\npm\node_modules\@iflow-ai\iflow-cli\bundle\iflow.js"
```

## æ ¹æœ¬åŸå› 

### 1. iflow-cli çš„åŠ è½½æœºåˆ¶

iflow-cli åœ¨å¯åŠ¨æ—¶**è‡ªåŠ¨æ‰«æ** `.iflow/commands/` ç›®å½•ï¼š
- æŸ¥æ‰¾æ‰€æœ‰ `.md` æ ¼å¼çš„å‘½ä»¤å®šä¹‰æ–‡ä»¶
- è§£æå¹¶æ³¨å†Œè¿™äº›å‘½ä»¤
- å¦‚æœç›®å½•ä¸å­˜åœ¨æˆ–æ–‡ä»¶ç¼ºå¤±ï¼Œå¯èƒ½å¯¼è‡´å¯åŠ¨å¤±è´¥

### 2. é¡¹ç›®çŠ¶æ€åˆ†æ

ä» git status å¯ä»¥çœ‹åˆ°ï¼š
```
D .iflow/commands/dnaspec-agent-creator.md
D .iflow/commands/dnaspec-architect.md
D .iflow/commands/dnaspec-cache-manager.md
D .iflow/commands/dnaspec-constraint-generator.md
D .iflow/commands/dnaspec-dapi-checker.md
D .iflow/commands/dnaspec-git-operations.md
D .iflow/commands/dnaspec-modulizer.md
D .iflow/commands/dnaspec-task-decomposer.md
```

**æ‰€æœ‰ iflow å‘½ä»¤æ–‡ä»¶éƒ½è¢«åˆ é™¤ï¼ˆæ ‡è®°ä¸º Dï¼‰**ï¼Œå¹¶è¢«ç§»åŠ¨åˆ° `archive_uncertain/.iflow/commands/` ç›®å½•ã€‚

### 3. ä¸ºä»€ä¹ˆåˆ é™¤åä»ç„¶å°è¯•åŠ è½½ï¼Ÿ

è¿™æ˜¯æ‚¨æå‡ºçš„**å…³é”®é—®é¢˜**ï¼é—®é¢˜çš„æ ¹æºåœ¨äºï¼š

**iflow-cli çš„è®¾è®¡æ˜¯è‡ªåŠ¨æ‰«æç›®å½•ï¼Œè€Œä¸æ˜¯ä¾èµ–é…ç½®æ–‡ä»¶ã€‚**

```
iflow-cli å¯åŠ¨
    â†“
æ‰«æ .iflow/commands/ ç›®å½•
    â†“
æŸ¥æ‰¾æ‰€æœ‰ .md æ–‡ä»¶
    â†“
è§£æå¹¶æ³¨å†Œå‘½ä»¤
    â†“
å¦‚æœæœŸæœ›çš„å‘½ä»¤ä¸å­˜åœ¨ â†’ å¤±è´¥
```

**æ²¡æœ‰é…ç½®æ–‡ä»¶éœ€è¦æ›´æ–°**ï¼Œä½†æ˜¯ï¼š
- iflow-cli å¯èƒ½å†…éƒ¨ç¼“å­˜äº†å‘½ä»¤åˆ—è¡¨
- æˆ–è€…æœŸæœ›æŸäº›å¿…éœ€å‘½ä»¤å­˜åœ¨
- å½“è¿™äº›å‘½ä»¤è¢«åˆ é™¤æ—¶ï¼Œå¯åŠ¨å¤±è´¥

## æ‚¨æå‡ºçš„æ­£ç¡®è®¾è®¡åŸåˆ™

> "åº”è¯¥æŠŠåˆ é™¤è¿™äº›å‘½ä»¤å’Œæ›´æ–°ç›¸å…³é…ç½®åšæˆä¸€ä¸ªåŸå­ä»»åŠ¡ï¼Œå¦‚æœåç»­æ²¡å®Œæˆå¿…é¡»å›æ»š"

è¿™ä¸ªåŸåˆ™å®Œå…¨æ­£ç¡®ï¼è¿™å°±æ˜¯**åŸå­æ€§æ“ä½œï¼ˆAtomic Operationsï¼‰**çš„æ ¸å¿ƒæ€æƒ³ã€‚

## è§£å†³æ–¹æ¡ˆ

### 1. ç«‹å³ä¿®å¤ï¼ˆå·²å®Œæˆï¼‰

âœ… æ¢å¤ `.iflow/commands/` ç›®å½•å’Œæ‰€æœ‰å‘½ä»¤æ–‡ä»¶
âœ… éªŒè¯ iflow-cli å¯ä»¥æ­£å¸¸å¯åŠ¨

### 2. é•¿æœŸè§£å†³æ–¹æ¡ˆï¼ˆå·²å®ç°ï¼‰

åˆ›å»º **CLI Command Manager** å·¥å…·ï¼Œå®ç°åŸå­æ€§æ“ä½œï¼š

#### æ ¸å¿ƒç‰¹æ€§

**âœ… åŸå­æ€§éƒ¨ç½²**
```bash
python tools/cli_command_manager.py deploy --platforms iflow
```
- å¤‡ä»½ç°æœ‰çŠ¶æ€
- éƒ¨ç½²æ–°å‘½ä»¤
- éªŒè¯éƒ¨ç½²ç»“æœ
- **å¦‚æœä»»ä½•æ­¥éª¤å¤±è´¥ï¼Œè‡ªåŠ¨å›æ»š**

**âœ… åŸå­æ€§åˆ é™¤**
```bash
python tools/cli_command_manager.py remove --platforms iflow
```
- åˆ›å»ºå¤‡ä»½
- åˆ é™¤å‘½ä»¤æ–‡ä»¶
- éªŒè¯åˆ é™¤ç»“æœ
- **å¦‚æœå¤±è´¥ï¼Œè‡ªåŠ¨æ¢å¤**

**âœ… äº‹åŠ¡è¿½è¸ª**
```bash
python tools/cli_command_manager.py status
```
- æ‰€æœ‰æ“ä½œéƒ½æœ‰å”¯ä¸€äº‹åŠ¡ ID
- è®°å½•æ“ä½œçŠ¶æ€ã€æ—¶é—´æˆ³ã€å¤‡ä»½è·¯å¾„
- æ”¯æŒæŸ¥è¯¢å’Œå›æ»š

#### å®ç°åŸç†

```python
# éƒ¨ç½²æµç¨‹
def deploy(platforms):
    transaction = create_transaction()
    try:
        backup = create_backup(platforms)      # æ­¥éª¤ 1: å¤‡ä»½
        deploy_commands(platforms)             # æ­¥éª¤ 2: éƒ¨ç½²
        validate_deployment(platforms)         # æ­¥éª¤ 3: éªŒè¯
        transaction.status = 'completed'
    except Exception as e:
        restore_backup(backup, platforms)      # å¤±è´¥æ—¶å›æ»š
        transaction.status = 'failed'
```

### 3. åŸå­æ€§æ“ä½œçš„é‡è¦æ€§

#### é—®é¢˜åœºæ™¯å¯¹æ¯”

**âŒ æ‰‹åŠ¨æ“ä½œï¼ˆä¸å®‰å…¨ï¼‰**
```bash
# æ­¥éª¤ 1: åˆ é™¤å‘½ä»¤æ–‡ä»¶
rm -rf .iflow/commands/*.md

# æ­¥éª¤ 2: å¯èƒ½è¿˜éœ€è¦åšå…¶ä»–æ“ä½œ...
# ï¼ˆä½†æ˜¯å¦‚æœæ­¥éª¤ 2 å¤±è´¥äº†ï¼Œæ­¥éª¤ 1 å·²ç»æ— æ³•æ’¤é”€ï¼‰

# iflow-cli å¯åŠ¨å¤±è´¥ï¼
# å› ä¸ºå‘½ä»¤æ–‡ä»¶å·²ç»è¢«åˆ é™¤ï¼Œæ— æ³•æ¢å¤
```

**âœ… ä½¿ç”¨å·¥å…·ï¼ˆå®‰å…¨ï¼‰**
```bash
# åŸå­æ€§æ“ä½œ
python tools/cli_command_manager.py remove --platforms iflow

# æµç¨‹ï¼š
# 1. è‡ªåŠ¨å¤‡ä»½ â†’ .dnaspec/backups/backup_xxx
# 2. åˆ é™¤å‘½ä»¤
# 3. éªŒè¯åˆ é™¤
# 4. å¦‚æœå¤±è´¥ â†’ è‡ªåŠ¨ä»å¤‡ä»½æ¢å¤
```

### 4. ä¸ºä»€ä¹ˆéœ€è¦åŸå­æ€§ï¼Ÿ

| åœºæ™¯ | æ‰‹åŠ¨æ“ä½œ | åŸå­æ€§æ“ä½œ |
|------|---------|-----------|
| åˆ é™¤å‘½ä»¤ | âŒ æ— æ³•æ’¤é”€ | âœ… è‡ªåŠ¨å¤‡ä»½ |
| éƒ¨ç½²å¤±è´¥ | âŒ çŠ¶æ€ä¸ä¸€è‡´ | âœ… è‡ªåŠ¨å›æ»š |
| æ“ä½œè¿½è¸ª | âŒ æ— è®°å½• | âœ… å®Œæ•´æ—¥å¿— |
| å¤šå¹³å°åŒæ­¥ | âŒ å®¹æ˜“é—æ¼ | âœ… æ‰¹é‡æ“ä½œ |
| é”™è¯¯æ¢å¤ | âŒ æ‰‹åŠ¨ä¿®å¤ | âœ… ä¸€é”®å›æ»š |

## å½“å‰çŠ¶æ€

### âœ… å·²å®Œæˆçš„ä¿®å¤

1. **æ¢å¤ iflow å‘½ä»¤æ–‡ä»¶**
   - ç›®å½•: `.iflow/commands/`
   - æ–‡ä»¶æ•°é‡: 8 ä¸ª
   - çŠ¶æ€: å…¨éƒ¨æ¢å¤

2. **éªŒè¯ iflow-cli æ­£å¸¸è¿è¡Œ**
   ```
   $ node "...\iflow-cli\bundle\iflow.js" --version
   0.4.10
   ```

3. **åˆ›å»º CLI Command Manager å·¥å…·**
   - æ–‡ä»¶: `tools/cli_command_manager.py`
   - æ–‡æ¡£: `tools/CLI_COMMAND_MANAGER_GUIDE.md`
   - çŠ¶æ€: å·²æµ‹è¯•ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨

### ğŸ“Š æ”¯æŒçš„å¹³å°

- âœ… iflow
- âœ… claude
- âœ… copilot
- âœ… gemini
- âœ… qwen
- âœ… qodercli
- âœ… codebuddy

## ä½¿ç”¨å»ºè®®

### 1. æµ‹è¯• iflow æŠ€èƒ½

ç°åœ¨å¯ä»¥æ­£å¸¸æµ‹è¯• iflow ä¸­çš„ dnaspec æŠ€èƒ½äº†ï¼š

```bash
# å¯åŠ¨ iflow
iflow

# ä½¿ç”¨ dnaspec å‘½ä»¤
/dnaspec.architect "è®¾è®¡ä¸€ä¸ªå¾®æœåŠ¡æ¶æ„"
/dnaspec.task-decomposer "åˆ†è§£è¿™ä¸ªç”¨æˆ·æ•…äº‹"
```

### 2. æœªæ¥æ“ä½œå‘½ä»¤

**éƒ¨ç½²åˆ°å¤šä¸ªå¹³å°ï¼š**
```bash
python tools/cli_command_manager.py deploy --platforms iflow,claude,copilot
```

**åˆ é™¤å‘½ä»¤ï¼ˆå®‰å…¨ï¼‰ï¼š**
```bash
python tools/cli_command_manager.py remove --platforms iflow
```

**æŸ¥çœ‹å†å²ï¼š**
```bash
python tools/cli_command_manager.py status
```

### 3. æœ€ä½³å®è·µ

âœ… **å§‹ç»ˆä½¿ç”¨ CLI Command Manager**
- ä¸è¦æ‰‹åŠ¨åˆ é™¤ `.iflow/commands/` ä¸‹çš„æ–‡ä»¶
- ä½¿ç”¨å·¥å…·è¿›è¡Œæ‰€æœ‰éƒ¨ç½²å’Œåˆ é™¤æ“ä½œ

âœ… **æ‰¹é‡æ“ä½œå‰å…ˆæµ‹è¯•**
- å…ˆåœ¨å•ä¸ªå¹³å°æµ‹è¯•
- éªŒè¯æˆåŠŸåå†æ‰¹é‡éƒ¨ç½²

âœ… **å®šæœŸæ£€æŸ¥äº‹åŠ¡çŠ¶æ€**
- ä½¿ç”¨ `status` å‘½ä»¤æŸ¥çœ‹å†å²
- åŠæ—¶å¤„ç†å¤±è´¥çš„äº‹åŠ¡

## æŠ€æœ¯è¦ç‚¹æ€»ç»“

### 1. æ‚¨çš„è§‚å¯Ÿå®Œå…¨æ­£ç¡®

> "åˆ é™¤æ—¶æ˜¯å¦åº”è¯¥æ›´æ–°å¯¹åº”çš„åŠ è½½ä»»åŠ¡æˆ–é’©å­æ–‡ä»¶ï¼Ÿ"

**ç­”æ¡ˆï¼šæ˜¯çš„ï¼**

è™½ç„¶ iflow-cli æ²¡æœ‰é…ç½®æ–‡ä»¶ï¼Œä½†åˆ é™¤å‘½ä»¤æ—¶åº”è¯¥ï¼š
1. âœ… åˆ›å»ºå¤‡ä»½
2. âœ… éªŒè¯åˆ é™¤
3. âœ… å¤±è´¥æ—¶å›æ»š
4. âœ… è®°å½•äº‹åŠ¡

è¿™æ­£æ˜¯ CLI Command Manager å®ç°çš„åŠŸèƒ½ã€‚

### 2. åŸå­æ€§æ“ä½œçš„ä»·å€¼

**ACID åŸåˆ™ï¼š**
- **A**tomicityï¼ˆåŸå­æ€§ï¼‰ï¼šå…¨éƒ¨æˆåŠŸæˆ–å…¨éƒ¨å¤±è´¥
- **C**onsistencyï¼ˆä¸€è‡´æ€§ï¼‰ï¼šçŠ¶æ€å§‹ç»ˆä¿æŒä¸€è‡´
- **I**solationï¼ˆéš”ç¦»æ€§ï¼‰ï¼šæ“ä½œä¸ä¼šç›¸äº’å¹²æ‰°
- **D**urabilityï¼ˆæŒä¹…æ€§ï¼‰ï¼šäº‹åŠ¡è®°å½•æ°¸ä¹…ä¿å­˜

### 3. å›æ»šæœºåˆ¶çš„é‡è¦æ€§

```python
# åŸå­æ€§æ“ä½œçš„å®ç°
try:
    backup = create_backup()
    perform_operation()
    validate()
    commit()
except:
    restore_backup(backup)  # è‡ªåŠ¨å›æ»š
    rollback()
```

## æ–‡ä»¶æ¸…å•

### æ–°åˆ›å»ºçš„æ–‡ä»¶

1. **tools/cli_command_manager.py**
   - åŸå­æ€§å‘½ä»¤éƒ¨ç½²ç®¡ç†å·¥å…·
   - æ”¯æŒå¤šå¹³å°ã€äº‹åŠ¡è¿½è¸ªã€è‡ªåŠ¨å›æ»š

2. **tools/CLI_COMMAND_MANAGER_GUIDE.md**
   - å®Œæ•´çš„ä½¿ç”¨æŒ‡å—
   - åŒ…å«ç¤ºä¾‹ã€æœ€ä½³å®è·µã€æ•…éšœæ’é™¤

### æ¢å¤çš„æ–‡ä»¶

1. **.iflow/commands/** (8 ä¸ªå‘½ä»¤æ–‡ä»¶)
   - dnaspec-agent-creator.md
   - dnaspec-architect.md
   - dnaspec-cache-manager.md
   - dnaspec-constraint-generator.md
   - dnaspec-dapi-checker.md
   - dnaspec-git-operations.md
   - dnaspec-modulizer.md
   - dnaspec-task-decomposer.md

## æ€»ç»“

### é—®é¢˜æ ¹æº
iflow-cli çš„å‘½ä»¤æ–‡ä»¶è¢«åˆ é™¤ï¼Œå¯¼è‡´å¯åŠ¨å¤±è´¥ã€‚

### æ‚¨çš„æ´å¯Ÿ
"åˆ é™¤æ—¶åº”è¯¥åšæˆåŸå­ä»»åŠ¡ï¼Œå¦‚æœåç»­æ²¡å®Œæˆå¿…é¡»å›æ»š" - **å®Œå…¨æ­£ç¡®ï¼**

### è§£å†³æ–¹æ¡ˆ
1. âœ… ç«‹å³æ¢å¤å‘½ä»¤æ–‡ä»¶
2. âœ… åˆ›å»ºåŸå­æ€§æ“ä½œå·¥å…·
3. âœ… å®ç°è‡ªåŠ¨å¤‡ä»½å’Œå›æ»š
4. âœ… æä¾›å®Œæ•´çš„äº‹åŠ¡è¿½è¸ª

### ä¸‹ä¸€æ­¥
- å¯ä»¥æ­£å¸¸åœ¨ iflow ä¸­æµ‹è¯• dnaspec æŠ€èƒ½
- ä½¿ç”¨ CLI Command Manager ç®¡ç†æœªæ¥çš„éƒ¨ç½²/åˆ é™¤æ“ä½œ
- éµå¾ªåŸå­æ€§æ“ä½œçš„æœ€ä½³å®è·µ

---

**ä¿®å¤æ—¶é—´**: 2025-12-25
**å·¥å…·ç‰ˆæœ¬**: CLI Command Manager v1.0
**çŠ¶æ€**: âœ… å®Œæˆ
