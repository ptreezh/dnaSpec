# 架构协调 - 基本应用

## 多层级调用模式

### 标准三层对齐

```yaml
表现层 (Presentation):
  API格式: REST/JSON
  错误处理: HTTP状态码
  超时: 30秒
  重试: 指数退避，最多3次

业务层 (Business):
  API格式: REST/JSON
  错误处理: HTTP状态码
  超时: 20秒
  重试: 指数退避，最多2次

数据层 (Data):
  API格式: REST/JSON
  错误处理: HTTP状态码
  超时: 10秒
  重试: 指数退避，最多1次
```

**关键原则**：
- 协议逐级统一
- 超时逐级递减
- 错误传播可预测

### 调用对齐检查清单

```yaml
协议对齐:
  - [ ] 统一API格式
  - [ ] 统一数据格式
  - [ ] 统一版本管理

错误处理对齐:
  - [ ] 统一错误码
  - [ ] 统一错误响应
  - [ ] 统一降级策略

超时对齐:
  - [ ] 超时逐级递减
  - [ ] 超时有明确原因
  - [ ] 超时有监控

重试对齐:
  - [ ] 重试策略统一
  - [ ] 重试次数限制
  - [ ] 避免重试风暴
```

---

## 协调模式

### 顺序协调

```
任务 → 子技能1 → 中间结果1
     → 子技能2 → 中间结果2
     → 子技能3 → 最终结果
```

**适用场景**：有明确依赖关系的任务

### 并行协调

```
任务 → 子技能1 ─┐
     → 子技能2 ─┼→ 汇总 → 最终结果
     → 子技能3 ─┘
```

**适用场景**：相互独立的子任务

### 混合协调

```
任务 → 子技能1 ─┐
     → 子技能2 ─┼→ 中间结果 → 子技能4 → 最终结果
     → 子技能3 ─┘
```

**适用场景**：部分任务可并行，部分有依赖

---

*本层覆盖基本的多层级调用模式和协调方法*
