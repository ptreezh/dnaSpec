"""
认知协同契约文件
DNASPEC技能系统协同执行的基本法
"""
version: "1.0.0"
created: "2025-12-15T20:00:00Z"
last_updated: "2025-12-15T20:00:00Z"

contract:
  title: "DNASPEC认知协同契约"
  description: "定义技能间协同机制的强制性契约"
  
  enforcement:
    # 一级优先级（强制执行）
    mandatory_coordination:
      - name: "temp_file_management"
        description: "临时文件管理协同：prevent提交临时文件到Git"
        level: "HARD_BLOCK"
        skills: ["temp_workspace", "temp_workspace_constitutional", "git_operations", "git_operations_constitutional"]
      
      - name: "context_chain_integrity" 
        description: "上下文链完整性：ensure context passing between analysis→optimization→template"
        level: "HARD_BLOCK"
        skills: ["context_analysis", "context_optimization", "cognitive_template", 
                "context_analysis_constitutional", "context_optimization_constitutional", "cognitive_template_constitutional"]
      
      - name: "security_constraint"
        description: "安全约束：force constitutional validation for all operations"
        level: "HARD_BLOCK" 
        skills: ["all_skills"]
    
    # 二级优先级（推荐执行）
    recommended_coordination:
      - name: "directory_structure_consistency"
        description: "目录结构一致性：maintain structural integrity during operations"
        level: "SOFT_BLOCK"
        skills: ["progressive_disclosure", "progressive_disclosure_constitutional", "git_operations", "git_operations_constitutional"]
      
      - name: "state_sharing"
        description: "状态共享：share quality metrics and validation status"
        level: "WARN"
        skills: ["all_construction_skills"]
      
      - name: "workspace_coordination" 
        description: "工作区协同：manage concurrent workspace access"
        level: "SOFT_BLOCK"
        skills: ["temp_workspace", "temp_workspace_constitutional"]
  
  shared_state_schema:
    temp_workspace:
      active_session: nullable string
      temp_files: array of string
      confirmed_files: array of string  
      session_start_time: nullable string
      
    context_chain:
      current_analysis: nullable object
      optimization_flags: array of string
      quality_scores: object
      context_id: nullable string
      
    security:
      validation_rules: array of string
      violation_tracker: array of object
      access_control: object
      
    directory_structure:
      current_structure: object
      proposed_changes: array of string
      consistency_status: string
      
    performance:
      quality_scores: object
      validation_stats: object
      execution_times: object

  hooks:
    pre_execution:
      - name: "contract_enforcement_check"
        description: "Execute contract checks before skill execution"
        mandatory: true
        
    post_execution: 
      - name: "contract_compliance_verification"
        description: "Verify contract compliance after skill execution"
        mandatory: true
        
    state_update:
      - name: "shared_state_sync"
        description: "Sync shared state after coordinated operations"
        mandatory: true

  violation_penalties:
    HARD_BLOCK:
      description: "Block operation execution"
      trigger: "Critical contract violations"
      
    SOFT_BLOCK:
      description: "Warn and suggest correction"
      trigger: "Significant contract violations"
      
    WARN:
      description: "Log violation for monitoring"
      trigger: "Minor contract inconsistencies"