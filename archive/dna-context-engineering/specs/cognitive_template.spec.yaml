# specs/cognitive_template.spec.yaml
spec_version: "1.0"
name: "cognitive-template"
display_name: "Cognitive Template"
description: "Apply cognitive templates for structured thinking"
version: "1.0.0"
category: "cognitive"

parameters:
  - name: "context"
    type: "string"
    description: "The context or task to apply cognitive template to"
    required: true
  - name: "template"
    type: "string"
    enum: ["chain_of_thought", "few_shot", "verification", "role_playing", "understanding"]
    default: "chain_of_thought"
    description: "Cognitive template to apply"
  - name: "role"
    type: "string"
    default: "expert"
    description: "Role for role-playing template (optional)"

implementation:
  instruction_template: |
    {% if template == 'chain_of_thought' %}
    请使用思维链方法分析以下任务：
    
    任务：{{context}}
    
    请按以下步骤进行分析：
    1. 问题理解：明确任务的核心需求和约束
    2. 步骤分解：将任务分解为可执行的子步骤
    3. 中间推理：在每个步骤中提供详细思考过程
    4. 验证检查：检查推理过程的合理性和逻辑性
    5. 最终答案：综合所有步骤给出最终结果
    
    请以结构化格式返回分析过程和最终结果。
    
    {% elif template == 'few_shot' %}
    请使用少样本学习方法处理以下任务：
    
    任务：{{context}}
    
    以下是一些示例：
    示例1：
    输入：分析电商系统架构
    输出：[架构分析结果]
    
    示例2：
    输入：设计数据库模型
    输出：[数据库设计结果]
    
    请根据上述示例模式处理您的任务，并详细说明推理过程。
    
    {% elif template == 'verification' %}
    请使用验证框架分析以下内容：
    
    原始内容：{{context}}
    
    请执行以下验证步骤：
    1. 初步答案：基于内容给出初始判断或答案
    2. 逻辑一致性检查：验证内容内部的逻辑一致性
    3. 事实准确性检查：检查陈述的准确性
    4. 完整性检查：评估是否包含所有必要信息
    5. 最终确认：综合以上检查给出最终确认
    
    请返回验证过程和最终结论。
    
    {% elif template == 'role_playing' %}
    请以{{role}}的角色视角分析以下任务：
    
    任务：{{context}}
    
    请从{{role}}的专业角度出发：
    1. 角色理解：{{role}}的专业能力是什么
    2. 专业分析：{{role}}如何理解这个任务
    3. 专业建议：{{role}}会给出什么建议
    4. 专业决策：{{role}}会如何决策
    
    请返回{{role}}视角的分析结果。
    
    {% elif template == 'understanding' %}
    请使用深度理解框架分析以下内容：
    
    内容：{{context}}
    
    请从以下角度进行理解：
    1. 核心目标：内容的主要目的是什么？
    2. 关键要素：包含哪些重要组成部分？
    3. 约束条件：有哪些限制和要求？
    4. 成功标准：如何判断任务完成得好？
    5. 潜在风险：可能存在哪些挑战？
    
    请返回深度理解结果和建议。
    {% endif %}

  result_processor: |
    import re
    try:
        response_text = response['raw_response'] if isinstance(response, dict) and 'raw_response' in response else str(response)
        
        return {
            'success': True,
            'template_name': context.get('template', 'chain_of_thought'),
            'template_description': {
                'chain_of_thought': '思维链推理',
                'few_shot': '少样本学习',
                'verification': '验证检查',
                'role_playing': '角色扮演',
                'understanding': '理解框架'
            }.get(context.get('template', 'chain_of_thought'), '未知模板'),
            'original_context': context.get('context', ''),
            'enhanced_context': response_text,
            'template_steps_applied': extract_steps_applied(response_text, context.get('template', 'chain_of_thought')),
            'processing_time': 0  # 实际系统中会记录
        }
    except Exception as e:
        return {
            'success': False,
            'template_name': context.get('template', 'chain_of_thought'),
            'error': f'Template application failed: {str(e)}',
            'raw_response': str(response)
        }

parameter_validator: |
  if not context.get('context') or not context['context'].strip():
      return {'valid': False, 'error': 'Context cannot be empty'}
  
  template = context.get('template', 'chain_of_thought')
  valid_templates = ['chain_of_thought', 'few_shot', 'verification', 'role_playing', 'understanding']
  if template not in valid_templates:
      return {'valid': False, 'error': f'Invalid template: {template}. Valid: {valid_templates}'}
  
  return {'valid': True}